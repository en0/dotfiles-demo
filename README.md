# Fun with dotfiles

This is a walk-through of how I setup my development environment.

## Get the VM running

First, lets get an ubuntu image up so we can all start from the same page.

```bash
vagrant up && vagrant halt && vagrant up
```

Login and get thought the ubuntu startup stuff and set your screen resolution to something
reasonable.

Username: Vagrant
Password: vagrant


## Getting dotfiles

Once you are logged in and the system is idel, open up a terminal and get dotfiles.

```bash
git clone https://github.com/en0/dotfiles.git .dotfiles
cd .dotfiles
git submodule init
# Fix the modules reference.
sed -i 's/git@github.com:en0/https:\/\/github.com\/en0/' .git/config
git submodule update --init --recursive
```

Before we get too far, lets get python3-venv. Dotfiles depends on it.

```bash
sudo apt install python3-venv
```

Now, we can verify dotfiles is ready to be used.

```bash
./dotfiles.sh info
```

## Install NeoVim

```bash
./dotfiles.sh install nvim
source ~/.dotfiles.env
```

Open up NeoVim with the `nvim` command.  Give nvim time to initialize for the first time. once
complete, close nvim with `:q`

Now, open nvim again and press `ctrl+p`. Notice the fonts are broken! Let's fix that.

```
./dotfiles.sh install dejavu-sans-mono-nerdfonts
```

Optionally, you can set your current terminal to use nerdfonts or you can install alacritty.

```bash
./dotfiles.sh install alacritty
```

If you installed alacritty, open it up and get back to the dotfiles directory in `~/.dotfiles`.

Open up nvim again and press `ctrl+p`. Should look good.

## Install ZShell

This is optional but if you don't do this, you will need to source the `~/.dotfiles.env` in your
bashrc.  The zsh configuration has that already done for you.

```bash
./dotfiles.sh install zprezto
sudo chsh -s /bin/zsh $USER
```

You will need to log out and back in for this to take effect. We will do that in a bit so just hang
tight and continue to installing i3.


## Install i3

Next, lets get I3 going. You can install i3 gaps or vanilla i3. In our version of ubuntu, i3 is in
repo, so we will go with that. If you want to install gaps, you can learn more
[here](https://github.com/Airblader/i3#:~:text=Gaps%20are%20the%20namesake%20feature,spacing%20along%20the%20screen%20edges).


Lets install vanilla i3.

```bash
sudo apt install i3
```

Lets also install polybar. Most distros have polybar in repo but for some special reason, ubuntu
doesn't (unless you are in 21.10+). We will build from source. You can get the details from
[here](https://github.com/polybar/polybar/wiki/Compiling)

```bash
sudo apt install build-essential git cmake cmake-data pkg-config python3-sphinx python3-packaging libuv1-dev libcairo2-dev libxcb1-dev libxcb-util0-dev libxcb-randr0-dev libxcb-composite0-dev python3-xcbgen xcb-proto libxcb-image0-dev libxcb-ewmh-dev libxcb-icccm4-dev
sudo apt install libxcb-xkb-dev libxcb-xrm-dev libxcb-cursor-dev libasound2-dev libpulse-dev i3-wm libjsoncpp-dev libmpdclient-dev libcurl4-openssl-dev libnl-genl-3-dev
cd ~
git clone --recursive https://github.com/polybar/polybar .polybar
cd .polybar
mkdir build
cd build
cmake ..
make -j$(nproc)
sudo make install
```

Logout and log in to i3. After you click on the vagrant user, click on the gear in the bottom right
conrer of the screen. Select "i3" and complete your login.

Now that we are in i3, you should see a window prompting about creating a config. We do not want a
autogenerated config.  Press escape.  Then press `alt+Return`. This will open a terminal.

If your resolution needs some help, you can use xrandr. 

```bash
xrandr # this will show you the display and resolution options.

# Set your resolution
xrandr --output Virtual1 --mode 2560x1600
```

Now, back to dotfiles. We need to make a hardware profile. This lets us customize our environment
for this computer and it's hardware. 

Navigate to `~/.dotfiles/` and open `nvim` then press `ctrl+p`.  Expand the `modules` directory and
find the hw-* folders.  We are going to create a new profile called `hw-demo`

- Highlight `hw-spoke`
- press `c` to copy that directory
- press `p` to paste it.
- press `r` to rename and change the name to `hw-demo`. This is visible at the bottom of the nvim
  window.
- press `enter`

now we can open up the settings.yaml inside our new profile and make some changes.

Make the profile look like this

```yaml
display:
  primary: Virtual1
  layout: xrandr --output Virtual1 --mode 2560x1600

polybar:
  networks:
  - eth0
```

If you are using i3 gaps, add this to your config

```yaml
i3:
  options:
  - gaps
```

Go back to the terminal and install the new hardware profile and i3 configs.

```bash
./dotfiles.sh install hw-demo i3
```

You should see the screen flicker and polybar should be at the top.

## Genetic Gnats

Lets get some real world experience.

```bash
cd ~
git clone https://github.com/en0/genetic-gnats
cd genetic-gnats
pytyhon3 -m venv venv
source venv/bin/activate
pip install pygame pytest
nvim
```

Explore the code and start to learn the profile.  You can see all the bindings in the dotfiles nvim
module in `~/.dotfiles/modules/nvim/init.d/keys.vim`.

To run, type `python3 -m simulation`

## Other great tools

### ./dotfiles.sh install scripts

This provides some handy scripts like `pytest-watch`, `git-list`, and `todo-list`.

If you want to use pytest-watch, you will need to install inotifywait

```bash
sudo apt install inotify-tools
```

### ./dotfiles.sh install workspace-lite

This provides a way to manage environment varables for different projects.

Here is an example envrc for workspace lite make for genetic gnats.

```bash
function on_enter() {
    source venv/bin/activate
    export PYTEST_WATCH_INCLUDE="brain simulation tests"
}

function on_exit() {
    deactivate
    unset PYTEST_WATCH_INCLUDE
    unset -f run
}

function run() {
    python3 -m simulation
}
```
